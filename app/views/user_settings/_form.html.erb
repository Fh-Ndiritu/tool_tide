<%= form_with model: current_user.user_setting_with_fallback, url: user_setting_path, method: :patch, id: "settings_form", class: "p-4 space-y-8" do |f| %>

  <!-- Section: Default Variations -->
  <div class="space-y-4">
    <div class="flex items-center justify-between">
      <div>
         <h3 class="text-sm font-semibold text-white">Default Variations</h3>
         <p class="text-[11px] text-gray-400 mt-0.5 leading-relaxed">
           For complex requests, increasing the variations will increase the chance of accurate results.
         </p>
      </div>
      <div class="h-8 w-8 rounded-lg bg-blue-500/20 text-blue-400 flex items-center justify-center font-bold text-sm border border-blue-500/30" id="variations-display">
        <%= current_user.default_variations %>
      </div>
    </div>

    <div class="relative py-2">
      <%= f.range_field :default_variations,
          min: 1,
          max: 4,
          step: 1,
          class: "w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",
          oninput: "document.getElementById('variations-display').innerText = this.value" %>
      <div class="flex justify-between text-[10px] text-gray-500 mt-2 font-medium px-0.5">
        <span>1 Image</span>
        <span>4 Images</span>
      </div>
    </div>
  </div>

  <!-- Section: Default Model -->
  <div class="space-y-4">
    <div>
      <h3 class="text-sm font-semibold text-white">Default Model</h3>
      <p class="text-[11px] text-gray-400 mt-0.5 leading-relaxed">
        Choose the AI model that powers your generations.
      </p>
    </div>

    <% if current_user.has_purchased_credits_before? %>
      <div class="grid grid-cols-1 gap-3">
        <!-- Pro Mode -->
        <label class="relative group cursor-pointer">
          <%= f.radio_button :default_model, MODEL_ALIAS_PRO, class: "peer sr-only" %>
          <div class="p-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all peer-checked:border-purple-500 peer-checked:bg-purple-500/10 peer-checked:ring-1 peer-checked:ring-purple-500/50">
            <div class="flex items-start justify-between mb-2">
               <div class="flex items-center gap-2">
                 <div class="p-1.5 rounded-md bg-purple-500/20 text-purple-300">
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                     <path fill-rule="evenodd" d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z" clip-rule="evenodd" />
                   </svg>
                 </div>
                 <span class="text-sm font-bold text-white group-hover:text-purple-200 transition-colors">Pro Mode</span>
               </div>
               <div class="h-4 w-4 rounded-full border border-gray-500 peer-checked:border-purple-500 peer-checked:bg-purple-500 flex items-center justify-center">
                 <div class="h-1.5 w-1.5 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition-opacity"></div>
               </div>
            </div>
            <p class="text-[11px] text-gray-400 leading-snug">
              Use our most intelligent model to ensure you get precise controls and realistic results.
            </p>
          </div>
        </label>

        <!-- Standard Mode -->
        <label class="relative group cursor-pointer">
          <%= f.radio_button :default_model, MODEL_ALIAS_STANDARD, class: "peer sr-only" %>
          <div class="p-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all peer-checked:border-blue-500 peer-checked:bg-blue-500/10 peer-checked:ring-1 peer-checked:ring-blue-500/50">
            <div class="flex items-start justify-between mb-2">
               <div class="flex items-center gap-2">
                 <div class="p-1.5 rounded-md bg-blue-500/20 text-blue-300">
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                     <path d="M10 3.75a2 2 0 1 0-4 0 2 2 0 0 0 4 0ZM17.25 4.5a.75.75 0 0 0-1.5 0h-2.25a.75.75 0 0 0 0 1.5h2.25a.75.75 0 0 0 1.5 0ZM7.5 7a.75.75 0 0 0-1.5 0h-2.25a.75.75 0 0 0 0 1.5H6a.75.75 0 0 0 1.5 0ZM12.5 13a.75.75 0 0 0-1.5 0h-2.25a.75.75 0 0 0 0 1.5h2.25a.75.75 0 0 0 1.5 0ZM17.25 10.5a.75.75 0 0 0-1.5 0H3.25a.75.75 0 0 0 0 1.5h12.5a.75.75 0 0 0 1.5 0ZM17.25 16.5a.75.75 0 0 0-1.5 0h-7.75a.75.75 0 0 0 0 1.5h7.75a.75.75 0 0 0 1.5 0Z" />
                   </svg>
                 </div>
                 <span class="text-sm font-bold text-white group-hover:text-blue-200 transition-colors">Standard</span>
               </div>
               <div class="h-4 w-4 rounded-full border border-gray-500 peer-checked:border-blue-500 peer-checked:bg-blue-500 flex items-center justify-center">
                 <div class="h-1.5 w-1.5 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition-opacity"></div>
               </div>
            </div>
            <p class="text-[11px] text-gray-400 leading-snug">
              Use our budget model which excels at simple tasks to manage costs.
            </p>
          </div>
        </label>
      </div>

    <% else %>
      <!-- Upgrade Teaser -->
      <div class="p-4 rounded-xl border border-purple-500/30 bg-gradient-to-br from-purple-900/40 to-black/40 space-y-3 relative overflow-hidden">
         <div class="absolute top-0 right-0 p-4 opacity-10">
            <svg class="w-24 h-24 text-purple-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
         </div>
         <div class="relative z-10 flex items-center gap-2 text-purple-200">
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-purple-400">
             <path fill-rule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5V9H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-.5V5.5A4.5 4.5 0 0 0 10 1Zm3 8V5.5a3 3 0 1 0-6 0V9h6Z" clip-rule="evenodd" />
           </svg>
           <span class="text-sm font-bold tracking-wide">Unlock Professional Tools</span>
         </div>
         <p class="relative z-10 text-xs text-purple-200/80 leading-relaxed">
           Purchase credits to unlock Pro Mode and persistent settings across all your projects.
         </p>
         <%= link_to "Get Credits", pricing_path, class: "relative z-10 block w-full py-2.5 text-center text-xs font-bold uppercase tracking-wider text-white bg-purple-600 hover:bg-purple-500 rounded-lg transition-all shadow-lg shadow-purple-900/40" %>
      </div>
      <%= f.hidden_field :default_model, value: MODEL_ALIAS_PRO %>
    <% end %>
  </div>

  <div class="pt-6 border-t border-white/10">
    <%= f.button class: "w-full py-3.5 bg-white hover:bg-gray-100 text-gray-900 text-xs font-bold uppercase tracking-widest rounded-xl transition-all shadow-lg shadow-white/5 active:scale-[0.98] flex items-center justify-center gap-2 group" do %>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-colors">
        <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" />
      </svg>
      Save Preferences
    <% end %>
  </div>
<% end %>
