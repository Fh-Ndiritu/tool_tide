<div class="bg-gray-900/50 p-3 rounded-xl border border-white/10 space-y-3 shadow-xl backdrop-blur-sm"
     data-controller="variations"
     data-action="change->variations#updateUI"
     data-project-onboarding-target="variations"
     data-variations-pro-cost-value="<%= GOOGLE_PRO_IMAGE_COST %>"
     data-variations-standard-cost-value="<%= GOOGLE_STANDARD_IMAGE_COST %>">

  <!-- Top Row: Helpers -->
  <div class="flex items-stretch gap-3 h-9">
     <!-- Model Segmented Control (Flex grow to fill space) -->
     <div class="flex-1 min-w-0 h-full flex flex-col">
       <%= render "projects/tools/model_selection",
                  input_name: local_assigns[:model_input_name] || "project_layer[model]",
                  selected_model: local_assigns[:selected_model],
                  user: local_assigns[:user] %>
     </div>

     <!-- Variations Stepper (Fixed width) -->
     <div class="flex items-center bg-black/40 rounded-lg p-1 border border-white/5 shrink-0">
        <button class="w-7 h-full flex items-center justify-center rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                data-action="click->variations#decrement"
                type="button">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" />
          </svg>
        </button>

        <span class="w-6 text-center text-xs font-bold text-white tabular-nums leading-none" data-variations-target="count"><%= local_assigns[:user]&.default_variations || 2 %></span>

        <button class="w-7 h-full flex items-center justify-center rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                data-action="click->variations#increment"
                type="button">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
        </button>
     </div>
  </div>

  <input type="hidden" name="variations" value="<%= local_assigns[:user]&.default_variations || 2 %>"
         data-variations-target="input"
         data-projects-target="variationsInput">

  <!-- Bottom Row: Action -->
  <button class="w-full group relative flex items-center justify-center gap-2 bg-[#00acc1] hover:bg-[#00838f] disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed text-white font-bold py-2.5 rounded-lg shadow-lg shadow-cyan-900/20 transition-all border border-white/10 overflow-hidden"
          data-action="click->projects#generate"
          data-projects-target="generateButton"
          disabled
          type="button">

     <!-- Shine Effect -->
     <div class="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/10 to-transparent z-0 pointer-events-none"></div>

     <!-- Content Label -->
     <span class="relative z-10 flex items-center gap-2" data-projects-target="generateLabel">
       <span>Generate</span>
       <span class="bg-black/20 text-[10px] px-1.5 py-0.5 rounded text-cyan-100 font-mono" data-variations-target="cost">
         <%= (local_assigns[:user]&.default_variations || 2) * GOOGLE_PRO_IMAGE_COST %> credits
       </span>
     </span>

     <!-- Loading State (Hidden by default) -->
     <div class="absolute inset-0 flex items-center justify-center bg-[#00acc1] hidden z-20" data-projects-target="generateLoader">
        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        <span class="ml-2">Generating...</span>
     </div>
  </button>
</div>
