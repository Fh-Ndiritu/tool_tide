<% @status_class =
   if  @current_request.id == text_request.id
  'border-accent '
  elsif text_request.complete?
  'border-neutral-300 '
  else
  'border-text-secondary '
  end %>

<%= link_to text_requests_path(current_request: text_request.id) do %>
  <div class="<%= @status_class %> relative my-4 w-40 md:w-full flex-shrink-0 aspect-video rounded-lg overflow-hidden border-2 hover:border-text-accent transition-colors duration-200 cursor-pointer">
    <% if text_request.result_image.attached? %>
      <%= image_tag text_request.result_image.variant(resize_to_limit: [120, 120]), alt: text_request.prompt, class: "w-full h-full object-cover" %>
    <% elsif text_request.original_image.attached? %>
      <%= image_tag text_request.original_image.variant(resize_to_limit: [120, 120]), alt: text_request.prompt, class: "w-full h-full object-cover" %>
    <% else %>
      <div
        class="
          w-full h-full bg-neutral-700 flex items-center justify-center
          text-xs text-neutral-400
        "
      >
        <p>No Image</p>
      </div>
    <% end %>

    <div class="absolute top-2 right-2 bg-black/50 p-1.5 rounded-full text-white hover:bg-accent transition-colors z-10 shadow-sm backdrop-blur-sm">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l9.832-9.832zm0 0L19.5 7.125" />
      </svg>
    </div>

    <div
      class="
        absolute inset-0 bg-black opacity-70 flex flex-col justify-end p-2
        text-text-light
      "
    >
      <p
        class="
          text-xs font-semibold whitespace-nowrap overflow-hidden
          text-ellipsis
        "
      >
        <%= text_request.prompt %>
      </p>
      <p class="text-[10px] text-neutral-300 mt-1">
        <%= time_ago_in_words(text_request.updated_at) %> ago
      </p>
    </div>

    <div id="<%= dom_id(text_request, :loader) %>" class="absolute inset-0 pointer-events-none z-20">
      <% if text_request.in_progress? %>
        <%= render partial: "layouts/shared/loader", locals: { record: text_request, klasses: "group embed absolute !opacity-75 z-1 w-full h-full" } %>
      <% end %>
    </div>
  </div>
<% end %>
