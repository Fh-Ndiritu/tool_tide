<%= form_with(model: text_request, class: "flex flex-col md:flex-row text-text-light overflow-auto ") do |form| %>
  <div
    class="
      w-full md:h-full max-w-[1000px] mx-auto flex flex-col md:flex-row
      overflow-hidden
    "
  >
    <main
      class="
        lg:flex-1 flex flex-col items-center justify-start p-4 md:p-8
        md:pb-12 bg-neutral-800
      "
    >
      <div class="w-full lg:md:h-full max-w-[700px] flex flex-col">
        <div
          class="
            lg:h-[60%] md:min-h-[400px] w-full flex-shrink-0 flex
            items-center justify-center
          "
        >
          <div
            class="
              relative w-full md:h-full rounded-lg overflow-hidden
              shadow-2xl flex items-center
            "
          >
            <% if text_request.original_image.attached? %>
              <div class="absolute inset-0 z-0">
                <%= image_tag text_request.original_image, class: "w-full md:h-full object-cover" %>
                <div class="absolute inset-0 backdrop-blur-xl bg-black/30"></div>
              </div>
              <div id="loader_overlay">
                <% if text_request.in_progress? %>
                  <%= render partial: "layouts/shared/loader", locals: { record: text_request, klasses: " group embed absolute w-full h-full z-1" } %>
                <% end %>
              </div>
              <div
                class="relative m-auto !w-[400px] h-auto flex z-10 juxtapose"
                data-startingposition="90"
              >
                <% if text_request.result_image.attached? %>
                  <%= image_tag text_request.result_image.variant(:juxtaposed), class: "w-[400px] object-contain", data: {label: "After"} %>
                <% else %>
                  <%= image_tag text_request.original_image.variant(:juxtaposed), class: "w-[400px] object-contain", data: {label: "After"} %>
                <% end %>
                <%= image_tag text_request.original_image.variant(:juxtaposed), class: "w-[400px] object-contain", data: {label: "Before"} %>
              </div>
            <% else %>
              <div
                class="
                  absolute inset-0 w-full md:h-full bg-neutral-700 flex
                  items-center justify-center
                "
              >
                <div class="flex flex-col items-center justify-center text-center">
                  <p class="relative text-neutral-500">
                    Generate an image in the AI landscaper to get started.
                  </p>
                  <%= link_to "Generate New Image", new_canva_path, class: "btn cute-btn" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
        <div class="lg:h-[40%] w-full flex-shrink-0 flex flex-col">
          <% if text_request.original_image.attached? %>
            <div class="my-3 mt-5">
              <%= form.label :prompt, "Image Prompt", class: "block mb-2 text-sm font-medium" %>
              <%= form.text_area :prompt, rows: 3, placeholder: "Add spaced out outdoor garden yellow lights along the paths and then convert the image to a night view.", class: "w-full p-3 rounded-lg bg-neutral-700 text-text-light border-4 border-neutral-500 focus:outline-none focus:border-text-primary focus:ring-2 focus:ring-text-primary resize-none transition-colors duration-200" %>
            </div>
            <div
              class="
                mt-1 pb-2 flex flex-col sm:flex-row justify-between
                items-center space-y-4 sm:space-y-0 sm:space-x-4
              "
            >
              <%= form.submit "Generate",
              class: "max-sm:!w-full cute-btn accent-btn" if current_user == text_request.user %>

              <% if current_user == text_request.user && text_request.result_image.attached? %>
                <%= link_to "HD Download",  rails_blob_path(text_request.result_image, disposition: :attachment), class: "max-sm:!w-full cute-btn secondary-btn" %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </main>
  </div>
<% end %>

<script
  src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"
></script>

<link
  rel="stylesheet"
  href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css"
>
