<%= form_with(model: feature) do |form| %>
  <% if feature.errors.any? %>
    <div
      id="error_explanation"
      class="bg-red-100 text-red-700 px-4 py-3 font-medium rounded-md mb-6"
    >
      <h2 class="font-bold mb-2">
        <%= pluralize(feature.errors.count, "error") %> prohibited this feature from being saved:
      </h2>

      <ul class="list-disc ml-6">
        <% feature.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-5">
    <div>
      <%= form.label :title, class: "font-semibold text-text-dark" %>

      <%= form.text_field :title,
        placeholder: "Summarize the feature (e.g., 'Dark Mode Toggle')",
        class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full",
          {"border-neutral-500 focus:outline-primary": feature.errors[:title].none?,
           "border-red-400 focus:outline-red-600": feature.errors[:title].any?}] %>
    </div>

    <div>
      <%= form.label :description, class: "font-semibold text-text-dark" %>

      <%= form.text_area :description, rows: 6,
        placeholder: "Describe the functionality and user value.",
        class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full resize-none",
          {"border-neutral-500 focus:outline-primary": feature.errors[:description].none?,
           "border-red-400 focus:outline-red-600": feature.errors[:description].any?}] %>
    </div>

    <%# --- Admin Fields with Stimulus Control --- %>
    <div data-controller="status-change">
      <div class="flex gap-4">
        <div class="flex-1">
          <%= form.label :progress, "Status", class: "font-semibold text-text-dark" %>

          <%= form.select :progress,
            Feature.progresses.map { |key, value| [key.humanize, key] },
            {},
            data: { action: "change->status-change#handleProgressChange", status_change_target: "progressSelect" },
            class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white",
              {"border-neutral-500 focus:outline-primary": feature.errors[:progress].none?,
               "border-red-400 focus:outline-red-600": feature.errors[:progress].any?}] %>
        </div>

        <div
          data-status-change-target="deliveryDateWrapper"
          class="flex-1 <%= feature.delivery_trackable? ? '' : 'hidden' %>"
        >
          <%= form.label :delivery_date, "Target Delivery Date", class: "font-semibold text-text-dark" %>

          <%= form.date_field :delivery_date,
            class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full",
              {"border-neutral-500 focus:outline-primary": feature.errors[:delivery_date].none?,
               "border-red-400 focus:outline-red-600": feature.errors[:delivery_date].any?}] %>
        </div>
      </div>
    </div>

    <div class="pt-2">
      <%= form.submit "Save Feature",
        class: "w-full rounded-md px-3.5 py-2.5 bg-cta-bg hover:opacity-90 text-text-dark font-medium cursor-pointer transition duration-150 ease-in-out" %>
    </div>
  </div>
<% end %>
