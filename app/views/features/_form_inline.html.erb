<%# app/views/features/_form_inline.html.erb %>

<%# Local variable: feature %>

<%= form_with(model: feature, data: { turbo_frame: dom_id(feature, :content) }) do |form| %>
  <div class="flex-1 pl-4 space-y-4">
    <% if feature.errors.any? %>
      <div class="bg-red-100 text-red-700 px-4 py-3 font-medium rounded-md">
        Validation failed.
      </div>
    <% end %>

    <div>
      <%= form.label :title, class: "font-semibold text-text-dark" %>

      <%= form.text_field :title,
        placeholder: "Summarize the feature",
        class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full",
          {"border-neutral-500 focus:outline-primary": feature.errors[:title].none?,
           "border-red-400 focus:outline-red-600": feature.errors[:title].any?}] %>
    </div>

    <div>
      <%= form.label :description, class: "font-semibold text-text-dark" %>

      <%= form.text_area :description, rows: 6,
        placeholder: "Describe the functionality and user value.",
        class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full resize-none",
          {"border-neutral-500 focus:outline-primary": feature.errors[:description].none?,
           "border-red-400 focus:outline-red-600": feature.errors[:description].any?}] %>
    </div>

    <%# --- Admin Fields with Stimulus Control --- %>
    <div data-controller="status-change">
      <div class="flex gap-4">
        <div class="flex-1">
          <%= form.label :progress, "Status", class: "font-semibold text-text-dark" %>

          <%= form.select :progress,
            Feature.progresses.map { |key, value| [key.humanize, key] },
            {},
            data: { action: "change->status-change#handleProgressChange", status_change_target: "progressSelect" },
            class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white",
              {"border-neutral-500 focus:outline-primary": feature.errors[:progress].none?,
               "border-red-400 focus:outline-red-600": feature.errors[:progress].any?}] %>
        </div>

        <div
          class="flex-1"
          data-status-change-target="deliveryDateWrapper"
          class="<%= feature.delivery_trackable? ? '' : 'hidden' %>"
        >
          <%= form.label :delivery_date, "Target Delivery Date", class: "font-semibold text-text-dark" %>

          <%= form.date_field :delivery_date,
            class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full",
              {"border-neutral-500 focus:outline-primary": feature.errors[:delivery_date].none?,
               "border-red-400 focus:outline-red-600": feature.errors[:delivery_date].any?}] %>
        </div>
      </div>
    </div>

    <%# --------------------------------------------- %>
    <div class="flex justify-end gap-2 pt-2">
      <%# Cancel button links back to the original content partial, replacing the form %>
      <%= link_to "Cancel", feature_path(feature),
          data: { turbo_frame: dom_id(feature, :content) },
          class: "rounded-md px-3 py-2 text-text-dark hover:bg-neutral-300 font-medium transition duration-150 ease-in-out" %>

      <%= form.submit "Save Changes",
          class: "rounded-md px-3 py-2 bg-accent hover:opacity-90 text-text-dark font-medium cursor-pointer transition duration-150 ease-in-out" %>
    </div>
  </div>
<% end %>
