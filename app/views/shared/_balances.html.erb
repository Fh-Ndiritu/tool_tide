<%
   is_cost_context = (controller_name == 'mask_requests' && (action_name == 'new' || action_name == 'edit')) || (controller_name == 'canvas' && action_name == 'new')
   cost = DEFAULT_IMAGE_COUNT * GOOGLE_IMAGE_COST

   # Removed grid logic, enforced single column stack
   base_classes = "flex flex-col gap-4 p-3 rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl group no-underline text-inherit"

   if is_cost_context
     if current_user.pro_engine_credits < cost
       color_classes = "bg-red-500/10 border border-red-500/20"
       text_class = "text-red-400"
     else
       color_classes = "bg-green-500/10 border border-green-500/20"
       text_class = "text-green-400"
     end
   else
      color_classes = "bg-white/10 border border-white/20"
     text_class = "text-neutral-300"
   end
%>

<div class="w-full my-4">
  <div class="<%= "#{base_classes} #{color_classes}" %>">
    <% if is_cost_context %>
      <div class="flex flex-col">
          <p class="text-sm <%= text_class %>">
            You have
            <strong class="<%= current_user.pro_engine_credits < cost ? 'text-red-400' : 'text-green-400' %>"><%= current_user.pro_engine_credits %></strong>
            credits and this feature will cost
            <strong class="text-secondary"><%= cost %></strong>
            credits.
          </p>

          <%# # if we are on canvas page, we let them know they can spend balance on smart fix %>
          <% if current_user.pro_engine_credits < cost && current_user.pro_engine_credits >= GOOGLE_IMAGE_COST  && current_user.mask_requests.complete.present? %>
            <div class="text-sm text-green-400 mt-1">
              ðŸ’¡ Tip: You still have enough credits for surgical edits with
              <%= button_to "Smart Fix", text_requests_path, method: :get, class: "cursor-pointer font-bold underline hover:text-green-300 bg-transparent border-0 p-0 inline align-baseline", form: { class: "inline-block ml-1" } %>
            </div>
          <% end %>
      </div>
    <% else %>
      <div class="flex flex-col gap-2 border-b border-white/10 pb-4">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-accent/10 rounded-full flex-shrink-0">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-accent"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M21 4H3a2 2 0 00-2 2v12a2 2 0 002 2h18a2 2 0 002-2V6a2 2 0 00-2-2zM3 8h18V6H3v2zm18 10H3v-6h18v6z"
              />
            </svg>
          </div>
          <div class="flex flex-col">
            <h3 class="text-xs font-medium text-neutral-400 uppercase tracking-wider">
              Total Available Credits
            </h3>
            <span class="text-lg font-extrabold text-[#00acc1] leading-tight">
              <%= current_user.pro_engine_credits %>
            </span>
          </div>
        </div>

        <p
          class="
            text-accent font-semibold text-xs mt-1 transition-colors
            duration-300 group-hover:text-accent-dark
          "
        >
          Manage Credits &rarr;
        </p>
      </div>
       <div class="flex flex-col gap-1 border-b border-white/10 pb-4">
        <h4 class="text-xs font-medium text-neutral-400 uppercase tracking-wider">
          Brush Edits
        </h4>
        <span class="text-lg font-bold text-[#f23faf]">24 Credits</span>
        <span class="text-xs text-neutral-500 mt-0">/ 3 images</span>
      </div>
      <div class="flex flex-col gap-1">
        <h4 class="text-xs font-medium text-neutral-400 uppercase tracking-wider">
          Ai Edits
        </h4>
        <span class="text-lg font-bold text-[#f23faf]">8 Credits</span>
        <span class="text-xs text-neutral-500 mt-0">/ edit request</span>
      </div>
    <% end %>
  </div>
</div>
