<%
   is_cost_context = (controller_name == 'mask_requests' && (action_name == 'new' || action_name == 'edit')) || (controller_name == 'canvas' && action_name == 'new')
   cost = DEFAULT_IMAGE_COUNT * GOOGLE_IMAGE_COST

   layout_classes = is_cost_context ? "flex flex-col" : "grid grid-cols-2 md:grid-cols-3"
   base_classes = "#{layout_classes} gap-4 p-3 rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl group no-underline text-inherit"

   if is_cost_context
     if current_user.pro_engine_credits < cost
       color_classes = "bg-red-50 border border-red-200"
       text_class = "text-red-700"
     else
       color_classes = "bg-green-50 border border-green-200"
       text_class = "text-green-700"
     end
   else
     color_classes = "bg-white border border-gray-200"
     text_class = "text-gray-700"
   end
%>

<div class="w-full my-4">
  <div class="<%= "#{base_classes} #{color_classes}" %>">
    <% if is_cost_context %>
      <div class="flex flex-col">
          <p class="text-sm <%= text_class %>">
            You have
            <strong class="<%= current_user.pro_engine_credits < cost ? 'text-red-800' : 'text-green-800' %>"><%= current_user.pro_engine_credits %></strong>
            credits and this feature will cost
            <strong class="text-secondary"><%= cost %></strong>
            credits.
          </p>

          <%# # if we are on canvas page, we let them know they can spend balance on smart fix %>
          <% if current_user.pro_engine_credits < cost && current_user.pro_engine_credits >= GOOGLE_IMAGE_COST  && current_user.mask_requests.complete.present? %>
            <div class="text-sm text-green-700 mt-1">
              ðŸ’¡ Tip: You still have enough credits for surgical edits with
              <%= button_to "Smart Fix", text_requests_path, method: :get, class: "cursor-pointer font-bold underline hover:text-green-900 bg-transparent border-0 p-0 inline align-baseline", form: { class: "inline-block ml-1" } %>
            </div>
          <% end %>
      </div>
    <% else %>
      <div
        class="
          flex flex-col gap-2 border-b border-gray-200 pb-4 md:border-b-0
          md:border-r md:pb-0 md:pr-4 col-span-2 md:col-span-1
        "
      >
        <div class="flex items-center gap-3">
          <div class="p-2 bg-accent/10 rounded-full flex-shrink-0">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-accent"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M21 4H3a2 2 0 00-2 2v12a2 2 0 002 2h18a2 2 0 002-2V6a2 2 0 00-2-2zM3 8h18V6H3v2zm18 10H3v-6h18v6z"
              />
            </svg>
          </div>
          <div class="flex flex-col">
            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">
              Total Available Credits
            </h3>
            <span class="text-lg font-extrabold text-primary leading-tight">
              <%= current_user.pro_engine_credits %>
            </span>
          </div>
        </div>

        <p
          class="
            text-accent font-semibold text-xs mt-1 transition-colors
            duration-300 group-hover:text-accent-dark
          "
        >
          Manage Credits &rarr;
        </p>
      </div>
      <div class="flex flex-col gap-1 border-r border-gray-200 pr-4">
        <h4 class="text-xs font-medium text-gray-700 uppercase tracking-wider">
          Brush Edits
        </h4>
        <span class="text-lg font-bold text-secondary">24 Credits</span>
        <span class="text-xs text-gray-400 mt-0">/ 3 images</span>
      </div>
      <div class="flex flex-col gap-1">
        <h4 class="text-xs font-medium text-gray-700 uppercase tracking-wider">
          Ai Edits
        </h4>
        <span class="text-lg font-bold text-secondary">8 Credits</span>
        <span class="text-xs text-gray-400 mt-0">/ edit request</span>
      </div>
    <% end %>
  </div>
</div>
