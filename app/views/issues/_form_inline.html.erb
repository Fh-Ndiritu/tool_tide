<%# app/views/issues/_form_inline.html.erb %>
<%# Local variables: issue %>

<%# This form will submit via Turbo, and the IssuesController#update will return the issue_card partial on success %>
<%= form_with(model: issue, data: { turbo_frame: dom_id(issue, :content) }) do |form| %>
  <div class="flex-1 pl-4 space-y-4">
    <% if issue.errors.any? %>
      <div class="bg-red-100 text-red-700 px-4 py-2 font-medium rounded-md">
        Validation failed.
      </div>
    <% end %>

    <%# 1. Title/Body (Editable by any admin/submitter) %>
    <%= form.text_field :title,
        placeholder: "Title",
        class: "block border-b-2 text-xl font-semibold border-neutral-300 focus:border-primary w-full" %>

    <%= form.text_area :body, rows: 4,
        placeholder: "Description",
        class: "block border-b-2 border-neutral-300 focus:border-primary w-full resize-none text-neutral-700" %>

    <%# 2. Admin/Progress Fields (Only relevant if admin is editing) %>
    <div data-controller="status-change">
      <div class="flex gap-4">
        <div class="flex-1">
          <%= form.label :progress, "Status", class: "text-sm font-medium text-text-dark block mb-1" %>

          <%= form.select :progress,
            Issue.progresses.map { |key, value| [key.humanize, key] },
            {},
            data: { action: "change->status-change#handleProgressChange", status_change_target: "progressSelect" },
            class: "block shadow-sm rounded-md border border-neutral-500 px-3 py-2 w-full bg-white focus:outline-primary" %>
        </div>

        <div
          class="flex-1"
          data-status-change-target="deliveryDateWrapper"
          class="<%= issue.delivery_trackable? ? '' : 'hidden' %>"
        >
          <%= form.label :delivery_date, "Delivery Date (Optional)", class: "text-sm font-medium text-text-dark block mb-1" %>

          <%= form.date_field :delivery_date,
            class: "block shadow-sm rounded-md border border-neutral-500 px-3 py-2 w-full focus:outline-primary" %>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-2 pt-2">
      <%# Cancel button links back to the original content partial %>
      <%= link_to "Cancel", issue_path(issue),
          data: { turbo_frame: dom_id(issue, :content) },
          class: "rounded-md px-3 py-2 text-text-dark hover:bg-neutral-300 font-medium transition duration-150 ease-in-out" %>

      <%= form.submit "Save Changes",
          class: "rounded-md px-3 py-2 bg-accent hover:opacity-90 text-text-dark font-medium cursor-pointer transition duration-150 ease-in-out" %>
    </div>
  </div>
<% end %>
