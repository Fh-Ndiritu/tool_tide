<%= form_with(model: issue) do |form| %>
  <%# --- Error Explanation Block --- %>
  <% if issue.errors.any? %>
    <div
      id="error_explanation"
      class="
        bg-red-50 text-red-700 border border-red-300 px-4 py-3
        font-medium rounded-lg mb-8 shadow-md
      "
    >
      <h2 class="font-bold mb-2">
        <%= pluralize(issue.errors.count, "error") %> prevented this issue from
        being submitted:
      </h2>

      <ul class="list-disc ml-6 text-sm">
        <% issue.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-6">
    <%# --- Title Field --- %>
    <div class="group">
      <%= form.label :title, class: "font-semibold text-text-dark text-sm block mb-1" %>

      <%= form.text_field :title,
        placeholder: "Summarize the issue clearly (e.g., 'Login button is missing')",
        class: [
          "block w-full px-4 py-2.5 rounded-lg border text-base shadow-sm",
          "transition duration-150 ease-in-out bg-white",
          # Standard/Focus states
          "group-hover:border-neutral-500 focus:outline-none focus:ring-1",
          # Error handling
          issue.errors[:title].any? ? "border-red-500 focus:ring-red-500" : "border-neutral-300 focus:border-primary focus:ring-primary"
        ].join(" ") %>
    </div>

    <%# --- Category Field --- %>
    <div class="group">
      <%= form.label :category, "Type of Issue", class: "font-semibold text-text-dark text-sm block mb-1" %>

      <%= form.select :category,
        Issue.categories.map { |key, value| [key.humanize, key] },
        { include_blank: "Select a Category" },
        class: [
          "block w-full px-4 py-2.5 rounded-lg border text-base shadow-sm appearance-none cursor-pointer",
          "transition duration-150 ease-in-out bg-white",
          # Standard/Focus states
          "group-hover:border-neutral-500 focus:outline-none focus:ring-1",
          # Error handling
          issue.errors[:category].any? ? "border-red-500 focus:ring-red-500" : "border-neutral-300 focus:border-primary focus:ring-primary"
        ].join(" ") %>
    </div>

    <%# --- Body/Details Field --- %>
    <div class="group">
      <%= form.label :body, "Details", class: "font-semibold text-text-dark text-sm block mb-1" %>

      <%= form.text_area :body, rows: 6,
        placeholder: "Describe the steps to reproduce the issue and expected behavior. Be detailed!",
        class: [
          "block w-full px-4 py-2.5 rounded-lg border text-base shadow-sm resize-y min-h-[10rem]",
          "transition duration-150 ease-in-out bg-white",
          # Standard/Focus states
          "group-hover:border-neutral-500 focus:outline-none focus:ring-1",
          # Error handling
          issue.errors[:body].any? ? "border-red-500 focus:ring-red-500" : "border-neutral-300 focus:border-primary focus:ring-primary"
        ].join(" ") %>
    </div>

    <%= form.hidden_field :user_id, value: current_user.id if defined?(current_user) %>

    <%# --- Submission Button --- %>
    <div class="pt-4">
      <%= form.submit "Submit Issue",
        class: "
          w-full rounded-xl px-6 py-3 text-lg font-semibold
          bg-cta-bg hover:bg-cta-bg/90 text-text-dark block text-center
          cursor-pointer transition duration-200 ease-in-out transform hover:scale-[1.01]
          shadow-xl shadow-cta-bg/40 focus:outline-none focus:ring-4 focus:ring-cta-bg/50
        " %>
    </div>
  </div>
<% end %>
