<turbo-stream action="replace" target="canvas_frame">
  <template>
    <%= turbo_frame_tag "canvas_frame" do %>
      <div class="relative w-full h-[80vh] flex items-center justify-center bg-gray-800 shadow-inner rounded-lg overflow-hidden" id="canvas-container">
        <div data-controller="project-canvas"
             data-project-canvas-target="canvasContainer"
             data-project-canvas-layer-id-value="<%= @project_layer.id %>"
             data-project-canvas-image-url-value="<%= url_for(@project_layer.display_image) %>"
             data-project-canvas-display-width-value="800"
             data-project-canvas-display-height-value="600"
             data-project-canvas-brush-size-value="60"
             class="bg-transparent">
        </div>
      </div>
    <% end %>
  </template>
</turbo-stream>

<turbo-stream action="update" target="auto_fix_results">
  <template>
    <% auto_fixes = @project_layer.auto_fixes.pending %>
    <% if auto_fixes.any? %>
      <%= render partial: "auto_fixes/auto_fix_item", collection: auto_fixes, as: :auto_fix, formats: [:html] %>
    <% else %>
      <div class="py-4">
        <%= button_to project_design_project_layer_auto_fixes_path(@project, @project_layer.design, @project_layer),
            method: :post,
            class: "w-full py-4 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg shadow-purple-900/30 transition-all flex items-center justify-center gap-3 group",
            data: { turbo_stream: true, disable_with: "Analyzing..." } do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 group-hover:scale-110 transition-transform">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
          </svg>
          Generate Fixes
        <% end %>
      </div>
    <% end %>
  </template>
</turbo-stream>

<turbo-stream action="update" target="project_sidebar_actions">
  <template>
    <%= render partial: "projects/project_context_actions", locals: { project: @project }, formats: [:html] %>
  </template>
</turbo-stream>
