<% @main_color =  if mask_request.user.admin? && mask_request.personal?
'bg-blue-100 '
 elsif mask_request.everyone?
'bg-red-100 '
 else
  'bg-green-100 '
 end %>

<div
  class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12"
  id="<%= dom_id(mask_request) %>"
>
  <div class="<%= @main_color %> rounded-2xl shadow-2xl border border-gray-200 p-3 space-y-4">
    <div class="flex flex-col max-sm:items-center md:justify-between">
      <h3 class="text-xl font-extrabold leading-tight text-neutral-900">
        Results for <%= mask_request.preset.humanize %> Style Design
      </h3>

      <h4 class="text-base text-secondary"><%= mask_request.user_error %></h4>

      <p class="text-sm text-gray-600">
        User:
        <%= mask_request.user.email %>
        <% if mask_request.user.state_address.present? %>
          <span class="font-semibold text-blue-600 ml-2">üìç <%= mask_request.user.state_address %></span>
        <% end %>
      </p>
    </div>

    <%# The main request view containing the tag management section %>
    <div
      class="
        flex flex-col gap-6 p-4 border-b border-neutral-300 md:flex-row
        md:justify-start md:items-stretch
      "
      data-controller="turbo-method"
    >
      <% if mask_request.trial_generation? || mask_request.user.admin? %>
        <% if mask_request.everyone? %>
          <div class="w-full md:w-auto md:flex-grow-0 md:basis-5/12 **h-full**">
            <%= render 'admin/tags/form', mask_request: mask_request %>
          </div>
          <div
            class="
              w-full md:w-auto md:flex-grow-0 md:basis-7/12 p-4
              md:border-t-0 md:pt-0 bg-neutral-100 rounded-lg shadow-sm
              border border-neutral-300 **h-full**
            "
          >
            <%# 1. Action Button %>
            <div class="flex justify-start mb-4 gap-2">
              <%= button_to "Hide from public",
              admin_mask_requests_toggle_display_path(id: mask_request.id),
              class: "cute-btn secondary-btn" %>

              <% if mask_request.user.admin? %>
                <%= button_to "Delete",
                    admin_mask_request_path(mask_request),
                    method: :delete,
                    data: { turbo_confirm: "Are you sure you want to delete this admin request?" },
                    class: "cute-btn bg-red-600 hover:bg-red-700 text-white" %>
              <% end %>
            </div>

            <%# 2. Tag List Header and Display %>
            <h4
              class="
                text-lg font-bold text-text-dark mb-3 pt-4 border-t
                border-neutral-300 md:border-t-0 md:pt-0
              "
            >
              Current Tags
            </h4>

            <%# Tags use an inner 2-column grid to look neat in the available space %>
            <div
              id="mask_request_tags"
              class="grid grid-cols-1 sm:grid-cols-2 gap-2"
            >
              <% if mask_request.tags.any? %>
                <%= render partial: 'admin/tags/tag', collection: mask_request.tags %>
              <% else %>
                <p class="text-sm text-neutral-700 italic sm:col-span-2">
                  No tags have been added yet.
                </p>
              <% end %>
            </div>
          </div>
        <% else %>
          <div class="flex items-center gap-2">
            <%= button_to "List on Explore",
                admin_mask_requests_toggle_display_path(id: mask_request.id),
                class: "cute-btn primary-btn" %>

            <% if mask_request.user.admin? %>
              <%= button_to "Delete",
                  admin_mask_request_path(mask_request),
                  method: :delete,
                  data: { turbo_confirm: "Are you sure you want to delete this admin request?" },
                  class: "cute-btn bg-red-600 hover:bg-red-700 text-white" %>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>

    <hr class="border-t border-neutral-300">

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
      <% if mask_request.main_view.attached? %>
        <div
          class="
            group relative overflow-hidden rounded-sm shadow-lg
            transition-all duration-500 transform hover:scale-105
          "
        >
          <%= image_tag(mask_request.main_view.variant(resize_to_limit: [500, 500]), loading: :lazy, class: "w-full max-h-[400px] object-cover transition-transform duration-500 group-hover:scale-110") %>
          <div
            class="
              absolute inset-0 bg-gradient-to-t from-black via-transparent
              to-transparent opacity-70
            "
          ></div>

          <div class="absolute bottom-4 left-4 right-4 text-white">
            <p class="text-lg font-bold">Main Shot</p>
          </div>

          <div class="absolute bottom-4 right-4 z-10 flex space-x-3">
            <%= link_to rails_blob_path(mask_request.main_view, disposition: :attachment), class: "h-8 w-8 flex items-center justify-center rounded-full bg-accent text-white shadow-xl backdrop-blur-md transition-all duration-300 transform hover:scale-110 hover:bg-secondary active:scale-95" do %>
              <%= render(IconComponent.new(classes: "h-6 w-6", name: "download")) %>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if mask_request.rotated_view.attached? %>
        <div
          class="
            group relative overflow-hidden rounded-sm shadow-lg
            transition-all duration-500 transform hover:scale-105
          "
        >
          <%= image_tag(mask_request.rotated_view.variant(resize_to_limit: [500, 500]), loading: :lazy, class: "w-full max-h-[400px] object-cover transition-transform duration-500 group-hover:scale-110") %>
          <div
            class="
              absolute inset-0 bg-gradient-to-t from-black via-transparent
              to-transparent opacity-70
            "
          ></div>

          <div class="absolute bottom-4 left-4 right-4 text-white">
            <p class="text-lg font-bold">Rotated View</p>
          </div>

          <div class="absolute bottom-4 right-4 z-10 flex space-x-3">
            <%= link_to rails_blob_path(mask_request.rotated_view, disposition: :attachment), class: "h-8 w-8 flex items-center justify-center rounded-full bg-accent text-white shadow-xl backdrop-blur-md transition-all duration-300 transform hover:scale-110 hover:bg-secondary active:scale-95" do %>
              <%= render(IconComponent.new(classes: "h-6 w-6", name: "download")) %>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if mask_request.drone_view.attached? %>
        <div
          class="
            group relative overflow-hidden rounded-sm shadow-lg
            transition-all duration-500 transform hover:scale-105
          "
        >
          <%= image_tag(mask_request.drone_view.variant(resize_to_limit: [500, 500]), loading: :lazy, class: "w-full max-h-[400px] object-cover transition-transform duration-500 group-hover:scale-110") %>
          <div
            class="
              absolute inset-0 bg-gradient-to-t from-black via-transparent
              to-transparent opacity-70
            "
          ></div>

          <div class="absolute bottom-4 left-4 right-4 text-white">
            <p class="text-lg font-bold">Drone Shot</p>
          </div>

          <div class="absolute bottom-4 right-4 z-10 flex space-x-3">
            <%= link_to rails_blob_path(mask_request.drone_view, disposition: :attachment), class: "h-8 w-8 flex items-center justify-center rounded-full bg-accent text-white shadow-xl backdrop-blur-md transition-all duration-300 transform hover:scale-110 hover:bg-secondary active:scale-95" do %>
              <%= render(IconComponent.new(classes: "h-6 w-6", name: "download")) %>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if mask_request.overlay.attached? %>
        <div
          class="
            group relative overflow-hidden rounded-sm shadow-lg
            transition-all duration-500 transform hover:scale-105
          "
        >
          <%= image_tag(mask_request.overlay.variant(resize_to_limit: [500, 500]), loading: :lazy, class: "w-full max-h-[400px] object-cover transition-transform duration-500 group-hover:scale-110") %>
          <div
            class="
              absolute inset-0 bg-gradient-to-t from-black via-transparent
              to-transparent opacity-70
            "
          ></div>

          <div class="absolute bottom-4 left-4 right-4 text-white">
            <p class="text-lg font-bold">Overlay Image</p>
          </div>

          <div class="absolute bottom-4 right-4 z-10 flex space-x-3">
            <%= link_to rails_blob_path(mask_request.overlay, disposition: :attachment), class: "h-8 w-8 flex items-center justify-center rounded-full bg-accent text-white shadow-xl backdrop-blur-md transition-all duration-300 transform hover:scale-110 hover:bg-secondary active:scale-95" do %>
              <%= render(IconComponent.new(classes: "h-6 w-6", name: "download")) %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
