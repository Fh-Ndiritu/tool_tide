  <% @canvas_dimensions = capture do
      concat 'data-konva-canvas-display-width-value='
      concat @mask_request.dimensions[:width]
      concat ' data-konva-canvas-display-height-value='
      concat @mask_request.dimensions[:height]
    end
%>
<% content_for :title, "New Design" %>
<%= turbo_stream_from "canva_#{@mask_request.canva.id}" %>
<div data-controller="mask-request"
     data-mask-request-image-url-value="<%= @mask_request.image.attached? ? url_for(@mask_request.drawable_image) : '' %>"
     class="h-auto bg-neutral-100 flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8 font-sans text-text-dark">
  <%= render 'shared/balances' %>
  <div class="w-full max-w-full lg:max-w-6xl bg-white rounded-2xl shadow-2xl overflow-hidden p-6 sm:p-8 border border-neutral-300">
    <h1 class="text-4xl sm:text-3xl font-extrabold text-text-primary text-center mb-8 tracking-wide">Draw areas to modify</h1>
    <div data-mask-request-target="editorSection" class="flex flex-col lg:flex-row gap-8">
      <div data-controller="konva-canvas"
           data-konva-canvas-target="canvasContainer"
           data-mask-request-target="konvaCanvasWrapper"
           data-konva-canvas-image-url-value="<%= @mask_request.image.attached? ? url_for(@mask_request.drawable_image) : '' %>"
           <%= @canvas_dimensions %>
           data-konva-canvas-brush-size-value="40"
           class="flex-1 bg-neutral-300 flex items-center justify-center relative rounded-xl overflow-hidden shadow-inner aspect-video">
      </div>
      <div class="lg:w-1/3 flex flex-col space-y-8 p-4">
        <div class="flex w-full flex-row items-center justify-between gap-4 pb-6 border-b-2 border-neutral-300">
          <div class="flex items-center gap-4">
            <div class="flex flex-col items-center gap-1">
              <button data-action="click->mask-request#undoPaintAction"
                data-mask-request-target="undoButton"
                class="p-2 w-12 h-12 flex items-center justify-center bg-white rounded-xl text-neutral-800 border border-neutral-300 hover:bg-neutral-100 transition-colors duration-200 ease-in-out shadow-sm"
                title="Undo Last Action">
                <%= render(IconComponent.new(name: "arrow-counter-clockwise", classes: "h-6 w-6")) %>
              </button>
              <span class="text-xs font-medium text-neutral-600">Undo</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <button data-action="click->mask-request#redoPaintAction"
                data-mask-request-target="redoButton"
                class="p-2 w-12 h-12 flex items-center justify-center bg-white rounded-xl text-neutral-800 border border-neutral-300 hover:bg-neutral-100 transition-colors duration-200 ease-in-out shadow-sm"
                title="Redo Last Undo">
                <%= render(IconComponent.new(name: "arrow-clockwise", classes: "h-6 w-6")) %>
              </button>
              <span class="text-xs font-medium text-neutral-600">Redo</span>
            </div>
          </div>
          <div class="flex flex-col items-center gap-1">
            <button data-action="click->mask-request#clearSelection"
              class="w-12 h-12 flex items-center justify-center p-2 bg-secondary rounded-xl text-text-light hover:opacity-80 transition-colors duration-200 ease-in-out shadow-sm"
              title="Clear Selection">
              <%= render(IconComponent.new(name: "x-circle", classes: "h-6 w-6")) %>
            </button>
            <span class="text-xs font-medium text-neutral-600">Clear</span>
          </div>
        </div>
        <div data-mask-request-target="brushSizeControl" class="space-y-4">
          <label for="brush-size" class="flex items-center justify-between text-sm font-semibold text-neutral-700">
            <span>Brush Size</span>
            <span data-mask-request-target="brushSizeDisplay" class="text-xs font-semibold text-text-accent">40px</span>
          </label>
          <div class="flex items-center gap-4">
            <div class="w-4 h-4 bg-neutral-500 rounded-full flex-shrink-0"></div>
            <div class="flex-grow relative h-8 flex items-center">
              <input type="range" id="brush-size" min="20" max="100" value="40" data-action="input->mask-request#updateBrushSize"
              class="w-full h-1 bg-neutral-300 rounded-full appearance-none cursor-pointer accent-accent transition-colors duration-200 ease-in-out slider-funnel-track">
            </div>
            <div class="w-8 h-8 bg-neutral-500 rounded-full flex-shrink-0"></div>
          </div>
        </div>
        <%= render "form", mask_request: @mask_request, canva: @canva %>
      </div>
    </div>
  </div>
</div>
