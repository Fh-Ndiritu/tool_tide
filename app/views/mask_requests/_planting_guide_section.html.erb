<div id="planting_guide_section">
  <% if mask_request.fetching_plant_suggestions? %>
    <div class="flex flex-col items-center justify-center p-8 bg-white/5 rounded-2xl border border-dashed border-white/10 animate-pulse">
      <div class="w-12 h-12 rounded-full border-4 border-green-500 border-t-transparent animate-spin mb-4"></div>
      <h3 class="text-xl font-bold text-white mb-2">Analyzing Garden...</h3>
      <p class="text-green-400 font-medium text-center">
        Identifying plants and generating your guide.<br>
        This usually takes about 30 seconds.
      </p>
    </div>
  <% elsif mask_request.plants.present? %>
  <div class="flex items-center gap-3 pb-4">
    <span class="text-2xl">ðŸŒ±</span>
    <h3 class="text-2xl font-bold text-white">Planting Guide</h3>
  </div>
  <h4 class="text-base w-full mb-4 flex items-center gap-2 text-accent">
    <%# # render location icon  %>
    <%= render(IconComponent.new(name: "map_pin", classes: "h-3 w-3")) %>
    Personalized to your location: <%= mask_request.user.state_address %>
  </h4>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <% mask_request.plants.each do |plant| %>
      <div
        class="
          bg-white/5 rounded-xl p-5 border border-white/10
          hover:border-green-500/30 hover:shadow-md transition-all
          duration-300 group
        "
      >
        <div class="flex justify-between items-start mb-3">
          <h4
            class="
              font-bold text-lg text-white
              group-hover:text-green-400 transition-colors
            "
          >
            <%= plant.english_name %>
          </h4>
          <span
            class="
              bg-white/10 px-3 py-1 rounded-lg text-sm font-bold
              text-neutral-300 shadow-sm border border-white/10
            "
          >
            <%= plant.quantity %>x
          </span>
        </div>

        <p class="text-neutral-400 text-sm mb-4 leading-relaxed">
          <%= plant.description %>
        </p>

        <div
          class="
            flex items-center justify-between mt-auto pt-4
            border-t border-white/10
          "
        >
          <div
            class="
              text-xs font-medium text-neutral-400 bg-white/5 px-2 py-1
              rounded border border-white/10
            "
          >
            Size:
            <span class="text-white"><%= plant.size %></span>
          </div>

          <%= link_to "https://www.google.com/search?q=#{CGI.escape(plant.english_name + ' plant')}&tbm=isch", target: "_blank", rel: "noopener noreferrer", class: "inline-flex items-center gap-2 text-sm font-semibold text-blue-400 hover:text-blue-300 hover:underline" do %>
            <span>View Images</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
              fill="currentColor"
              class="w-4 h-4"
            >
              <path
                fill-rule="evenodd"
                d="M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5z"
                clip-rule="evenodd"
              />
              <path
                fill-rule="evenodd"
                d="M6.194 12.753a.75.75 0 001.06.053L16.5 4.44v2.81a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5a.75.75 0 000 1.5h2.553l-9.056 8.194a.75.75 0 00-.053 1.06z"
                clip-rule="evenodd"
              />
            </svg>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="flex flex-col items-center justify-center p-8 bg-white/5 rounded-2xl border border-dashed border-white/10">
    <div class="text-center max-w-md">
      <h3 class="text-xl font-bold text-white mb-2">Want details?</h3>
      <p class="text-neutral-400 mb-6">
        Generate a comprehensive planting guide based on this specific design.
        <% if mask_request.canva.user.latitude.present? %>
          <br><span class="text-sm text-green-600 font-medium">Using your location for improved accuracy.</span>
        <% end %>
      </p>

      <%= button_to "Generate Planting Guide",
          generate_planting_guide_mask_request_path(mask_request),
          method: :post,
          class: "cute-btn btn-primary w-full md:w-auto",
          data: { turbo: true } %>
    </div>
  </div>
<% end %>
</div>
